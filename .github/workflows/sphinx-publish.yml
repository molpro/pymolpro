name: Pages
on:
  push:
    tags:
      - '*'
    branches:
    - CI-pages
defaults:
  run:
    shell: bash -el {0}
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/setup-python@v2
#    - run: pip install versioneer
#    - uses: s-weigand/setup-conda@v1.2.3
#      with:
#        activate-conda: false
    - uses: actions/checkout@master
      with:
        fetch-depth: 0 # otherwise, you will failed to push refs to dest repo
    - uses: conda-incubator/setup-miniconda@v3
      with:
#        activate-environment: 'test'
        channels: conda-forge, defaults
        auto-activate-base: 'true'
    - name: Install python requirements
      run: |
        conda create -n doc -y -c conda-forge --file requirements.txt sphinx_rtd_theme nbsphinx scipy
        conda activate doc || true
        python -m pip install --no-deps --force-reinstall .
#    - run: sphinx-apidoc -o docs/source pymolpro
    - name: Build and Commit
      uses: sphinx-notes/pages@v3
      with:
        documentation_path: './docs/source'
        checkout: 'false'
        requirements_path: 'does_not_exist'
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: gh-pages
#  pages:
#    runs-on: ubuntu-latest
#    environment:
#      name: github-pages
#      url: ${{ steps.deployment.outputs.page_url }}
#    permissions:
#      pages: write
#      id-token: write
#    steps:
#      - id: deployment
#        uses: sphinx-notes/pages@v3
#        with:
##          pyproject_extras: sphinx_rtd_theme nbsphinx
#          documentation_path: './docs/source'
##      - name: Push changes
##        uses: ad-m/github-push-action@master
##        with:
##          github_token: ${{ secrets.GITHUB_TOKEN }}
##          branch: gh-pages
